/**
 * Admui-iframe v2.0.0 (http://www.admui.com/)
 * Copyright 2015-2018 Admui Team
 * Licensed under the Admui License 1.1 (http://www.admui.com/about/license)
 */
!function(o,t,c){"use strict";var e={loadMsg:function(e){o.top.notifyFn.render(),c.ajax({url:c.configs.ctx+"/public/data/system/message/messages.json",dataType:"JSON",type:"GET",data:{pageIndex:e,pageSize:10},success:function(e){var t;e&&void 0!==e.pageList?(t=template("newMessge",e.pageList),c("#messageLists").html(t)):toastr.error(e.msg)},error:function(){toastr.error("服务器异常，请稍后再试！")}})},fnExtend:function(){var t=this;c.extend(o.top.notifyFn,{messagePage:function(){var e=c("#messageLists");c(".account-msg").hasClass("active")&&(0===e.children(".no-message").length&&1!==c("#paging").data("page")||t.loadMsg(1))},msgStatus:function(e){var t=c('[data-message-id="'+e+'"]').children(".media"),a=t.children(".media-right").find("a");t.children(".media-body").find("i").remove(),a.attr("title","删除"),a.removeClass("wb-check").addClass("wb-close")}})},run:function(){var r=this,e=o.top.notifyFn.unReadMsg;this.loadMsg(1),this.fnExtend(),e&&c.isFunction(e)&&e(c("#admui-navbarMessage").find("span.msg-num").text()),c(t).on("click",".news-list",function(e){var t=c(this),a=t.parents(".list-group-item").data();a.readFlag=t.find("i.icon").length<=0,o.top.notifyFn.readMsg(a),e.preventDefault()}),c(t).on("click",".wb-check",function(e){e.preventDefault(),o.top.notifyFn.readMsg(c(this).parents("[data-message-id]").data())}),c(t).on("click",".wb-close",function(e){var t=c(this).closest(".list-group-item"),a=c(".msg-number"),s=Number(a.text()),n=c("#paging").data("page"),i=t.data("messageId");o.top.layer.confirm("你确定要删除吗？",function(t){c.ajax({url:"/message/"+i,type:"DELETE",dataType:"JSON",success:function(e){e.success?(r.loadMsg(n),s-=1,a.text(s),toastr.clear(),toastr.success(e.msg),o.top.layer.close(t)):toastr.error(e.msg)},error:function(){toastr.error("服务器异常，请配合后端程序使用")}})}),e.preventDefault()}),c(t).on("click",".previous, .next",function(){var e=c(this),t=e.parents("#paging").data("page"),a=e.parents("#paging").data("max-page"),s=c(".previous"),n=c(".next");e.is(".previous")?(n.is(":hidden")&&n.show(),2===t&&s.hide(),t-=1):e.is(".next")&&(s.is(":hidden")&&s.show(),t===a-1&&n.hide(),t+=1),r.loadMsg(t)})}};template.defaults.imports.iconType=function(e){switch(e){case"SYSTEM":return"fa-desktop system";case"TASK":return"fa-tasks task";case"SETTING":return"fa-cog setting";case"EVENT":return"fa-calendar event";default:return"fa-comment-o other"}},template.defaults.imports.timeMsg=function(e){var t=new Date,a=e.split(/[- :/]/),s=new Date(a[0],a[1]-1,a[2],a[3],a[4],a[5]);return o.top.notifyFn.timeDistance(s,t)},c(function(){e.run()})}(window,document,jQuery);